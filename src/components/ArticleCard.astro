---
/**
 * ArticleCard - Carte d'article pour les données Hashnode
 *
 * Ce composant affiche un aperçu d'un article récupéré depuis Hashnode.
 * Il est utilisé sur la page Articles et la page Home.
 */

import { Icon } from 'astro-icon/components'
import Link from './Link.astro'
import type { Post } from '@/lib/hashnode/types'
import { formatDate } from '@/lib/hashnode/api'

interface Props {
  post: Post
}

const { post } = Astro.props
const formattedDate = formatDate(post.publishedAt)
---

<Link
  href={`/articles/${post.slug}`}
  class="group block py-4 transition-all duration-200 hover:bg-muted/30 -mx-2 px-2 rounded-md"
>
  <div class="flex items-start justify-between gap-4">
    <div class="flex-1 min-w-0 space-y-1">
      <!-- Titre et date -->
      <div class="flex items-baseline gap-2.5">
        <h3 class="text-base font-semibold leading-snug group-hover:text-foreground transition-colors">
          {post.title}
        </h3>
        <span class="text-muted-foreground/60 text-xs font-normal whitespace-nowrap shrink-0">
          {formattedDate}
        </span>
      </div>

      <!-- Description -->
      <p class="text-muted-foreground text-sm leading-snug line-clamp-2">
        {post.brief}
      </p>

      <!-- Métadonnées -->
      <div class="flex flex-wrap items-center gap-x-2.5 gap-y-1 text-xs text-muted-foreground/80">
        <!-- Auteur -->
        {post.author && (
          <span class="font-medium">{post.author.name}</span>
          <span class="text-muted-foreground/40">·</span>
        )}

        <!-- Temps de lecture -->
        <span class="flex items-center gap-1">
          <Icon name="lucide:clock" class="size-3 text-primary/70" />
          {post.readTimeInMinutes} min
        </span>

        <!-- Série (si l'article appartient à une série) -->
        {post.series && (
          <>
            <span class="text-muted-foreground/40">·</span>
            <span class="flex items-center gap-1 text-primary/80">
              <Icon name="lucide:layers" class="size-3" />
              {post.series.name}
            </span>
          </>
        )}

        <!-- Tags -->
        {post.tags && post.tags.length > 0 && (
          <>
            <span class="text-muted-foreground/40">·</span>
            <div class="flex flex-wrap items-center gap-1">
              {post.tags.slice(0, 2).map((tag) => (
                <span class="text-[10px] px-1.5 py-0.5 rounded font-medium bg-muted text-muted-foreground/70 hover:text-foreground transition-colors">
                  {tag.name}
                </span>
              ))}
              {post.tags.length > 2 && (
                <span class="text-muted-foreground/50 text-[10px]">
                  +{post.tags.length - 2}
                </span>
              )}
            </div>
          </>
        )}
      </div>
    </div>

    <!-- Image de couverture (optionnelle, affichée sur les écrans plus larges) -->
    {post.coverImage && (
      <div class="hidden sm:block shrink-0">
        <img
          src={post.coverImage.url}
          alt={post.title}
          class="w-20 h-14 object-cover rounded-md opacity-80 group-hover:opacity-100 transition-opacity"
        />
      </div>
    )}
  </div>
</Link>
