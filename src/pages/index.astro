---
/**
 * Page Home
 *
 * Page d'accueil du blog avec :
 * - Section Hero (titre + description)
 * - Featured Series (séries mises en avant)
 * - Latest Articles (derniers articles)
 *
 * Les données viennent de Hashnode via les fonctions API.
 */

import ArticleCard from '@/components/ArticleCard.astro'
import SeriesCard from '@/components/SeriesCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import Layout from '@/layouts/Layout.astro'
import { Icon } from 'astro-icon/components'
import { SITE } from '@/consts'

// Import des fonctions API Hashnode
import { getFeaturedSeries, getRecentPosts } from '@/lib/hashnode/api'
import type { Post, Series } from '@/lib/hashnode/types'

// Récupération des données depuis Hashnode
let featuredSeries: Series[] = []
let latestPosts: Post[] = []

try {
  // Récupère les 2 premières séries (featured)
  featuredSeries = await getFeaturedSeries(2)
} catch (error) {
  console.error('Erreur lors de la récupération des séries:', error)
}

try {
  // Récupère les 5 derniers articles
  latestPosts = await getRecentPosts(5)
} catch (error) {
  console.error('Erreur lors de la récupération des articles:', error)
}

// Schema SEO pour la page d'accueil
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": SITE.title,
  "url": SITE.href,
  "description": SITE.description,
}
---

<Layout class="max-w-3xl">
  <PageHead slot="head" title={SITE.title} fullTitle={true} />

  <!-- Schema SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

  <!-- Hero Section -->
  <section class="py-12">
    <h1 class="text-4xl sm:text-5xl font-serif leading-tight mb-6">
      Exploring the frontiers of<br />
      <em class="text-primary">language models</em>, <em class="text-primary">agents</em>, and<br />
      <em class="text-primary">software design</em>.
    </h1>
    <p class="text-lg text-muted-foreground mb-4">
      {SITE.description}
    </p>
  </section>

  <!-- Featured Series Section -->
  {featuredSeries.length > 0 && (
    <section class="mt-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">
          Featured Series
        </h2>
        <Link
          href="/series"
          class="text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors"
        >
          View all series
          <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
      </div>

      <div class="border-t border-border pt-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {featuredSeries.map((series) => (
            <SeriesCard series={series} featured={true} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Latest Articles Section -->
  {latestPosts.length > 0 && (
    <section class="mt-16">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">
          Latest Articles
        </h2>
        <Link
          href="/articles"
          class="text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors"
        >
          Archive
          <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
      </div>

      <div class="border-t border-border">
        {latestPosts.map((post) => (
          <ArticleCard post={post} />
        ))}
      </div>
    </section>
  )}

  <!-- Message si pas de contenu -->
  {featuredSeries.length === 0 && latestPosts.length === 0 && (
    <section class="mt-12 text-center py-12 border border-dashed border-border rounded-lg">
      <Icon name="lucide:file-text" class="size-12 text-muted-foreground/50 mx-auto mb-4" />
      <h2 class="text-lg font-semibold mb-2">Pas encore de contenu</h2>
      <p class="text-muted-foreground mb-4">
        Commence par publier des articles sur Hashnode pour les voir apparaitre ici.
      </p>
      <Link
        href="https://hashnode.com"
        class={buttonVariants({ variant: 'outline' })}
        external
      >
        Aller sur Hashnode
        <Icon name="lucide:external-link" class="size-4 ml-2" />
      </Link>
    </section>
  )}
</Layout>
