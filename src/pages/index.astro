---
/**
 * Home Page
 *
 * Blog homepage with:
 * - Hero Section (title + description)
 * - Featured Series
 * - Latest Articles
 *
 * Data comes from Hashnode via API functions.
 */

import ArticleCard from "@/components/ArticleCard.astro";
import SeriesCard from "@/components/SeriesCard.astro";
import Link from "@/components/Link.astro";
import PageHead from "@/components/PageHead.astro";
import Layout from "@/layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import { SITE } from "@/consts";

import { getFeaturedSeries, getRecentPosts } from "@/lib/hashnode/api";
import type { Post, Series } from "@/lib/hashnode/types";

// Fetch data from Hashnode
let featuredSeries: Series[] = [];
let latestPosts: Post[] = [];

try {
	featuredSeries = await getFeaturedSeries(2);
} catch (error) {
	console.error("Error fetching series:", error);
}

try {
	latestPosts = await getRecentPosts(5);
} catch (error) {
	console.error("Error fetching articles:", error);
}

// SEO schema for homepage
const websiteSchema = {
	"@context": "https://schema.org",
	"@type": "WebSite",
	name: SITE.title,
	url: SITE.href,
	description: SITE.description,
};

// ISR: Cache 60s on Vercel, stale-while-revalidate 5min
Astro.response.headers.set(
	"Cache-Control",
	"s-maxage=60, stale-while-revalidate=300",
);
---

<Layout class="max-w-3xl">
  <PageHead slot="head" title={SITE.title} fullTitle={true} />

  <!-- Schema SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

  <!-- Hero Section -->
  <section class="py-12">
    <h1 class="text-4xl sm:text-5xl font-serif leading-tight mb-6">
      Exploring how <em class="text-primary">software</em>, <em class="text-primary">system design</em>, and <em class="text-primary">AI</em> really work.
    </h1>
    <p class="text-lg text-muted-foreground mb-4">
      {SITE.description}
    </p>
    <p class="text-muted-foreground">
      Currently building killer features for pharmacists at{' '}
      <a
        href="https://en.faks.co/"
        target="_blank"
        rel="noopener noreferrer"
        class="font-semibold text-foreground hover:underline"
      >Faks</a>.
    </p>
  </section>

  <!-- Featured Series Section -->
  {featuredSeries.length > 0 && (
    <section class="mt-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">
          Featured Series
        </h2>
        <Link
          href="/series"
          class="text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors"
        >
          View all series
          <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
      </div>

      <div class="border-t border-border pt-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {featuredSeries.map((series) => (
            <SeriesCard series={series} featured={true} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Latest Articles Section -->
  {latestPosts.length > 0 && (
    <section class="mt-16">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">
          Latest Articles
        </h2>
        <Link
          href="/articles"
          class="text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors"
        >
          Archive
          <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
      </div>

      <div class="border-t border-border">
        {latestPosts.map((post) => (
          <ArticleCard post={post} />
        ))}
      </div>
    </section>
  )}

  <!-- Empty state -->
  {featuredSeries.length === 0 && latestPosts.length === 0 && (
    <section class="mt-12 text-center py-12">
      <p class="text-xl text-muted-foreground">
        No content yet! Soon to come ðŸš€
      </p>
    </section>
  )}
</Layout>
